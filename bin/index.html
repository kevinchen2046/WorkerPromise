<html>

<head>
    <title>worker-promise</title>
    <meta charset='utf-8' />
    <meta name='renderer' content='webkit' />
    <meta name='viewport'
        content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no' />
    <meta name='apple-mobile-web-app-capable' content='yes' />
    <meta name='full-screen' content='true' />
    <meta name='x5-fullscreen' content='true' />
    <meta name='360-fullscreen' content='true' />
    <meta name='laya' screenorientation='landscape' />
    <meta http-equiv='expires' content='0' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1' />
    <meta http-equiv='expires' content='0' />
    <meta http-equiv='Cache-Control' content='no-siteapp' />
</head>

<body>
    <script type="text/javascript">
        function loadLib(url) {
            var script = document.createElement("script");
            script.async = false;
            script.src = url;
            document.body.appendChild(script);
        }
    </script>
    <script type="text/javascript" src="js/bundle.js"></script>


    <!-- <script>
class WorkerFile {
    constructor() {
        globalThis.onmessage = this.onmessage.bind(this);
        this.postMessage = (...args) => {
            globalThis.postMessage(...args)
        }
        //{{}}//
    }
    onmessage(e) {
        console.log(e.data);
        this.exec(resove=>{
            this.postMessage('msg from worker');
        });
    }
}

        function getWorkerString(clazz,method) {
            let str = clazz.toString();
            let name = str.toString().match(/(?<=class)(.*?)(?={)/)[0].replace(/ /g, "");
            str=str.replace(`//{{}}//`,`this.exec=${method.toString()}`)
            return `${str};\nnew ${name}();`
        }


        class WorkerPromise {
            static wait(method) {
                new Promise(reslove => {
                    // WorkerFile.prototype.exec = method;
                    //console.log(WorkerFile.prototype.toString());
                    var blob = new Blob([getWorkerString(WorkerFile,clazz)], { type: "text/javascript" })

                    // Note: window.webkitURL.createObjectURL() in Chrome 10+.
                    var worker = new Worker(window.URL.createObjectURL(blob));
                    worker.onmessage = function (e) {
                        console.log("Received: " + e.data);
                    }
                    worker.postMessage("hello"); // Start the worker.
                })
            }
        }

        WorkerPromise.wait(reslove=>{
            setTimeout(()=>reslove(),2000);
        })

    </script> -->
</body>

</html>